os: linux
dist: bionic
language: python
python:
- '3.7'
- '3.8'

before_install:
- echo -e "machine github.com\n  login $GITHUB_TOKEN" > ~/.netrc

install:
- pip install ".[test]"

script:
- pytest .
- mypy --ignore-missing-imports src

deploy:
  - provider: pypi
    username: "__token__"
    password:
      secure: "AJhnRnZcoHvsW9xrycLGTVvBQW6/3DaSvsw7Ebx3nKP70YVvXrnpYv8Cz7M2wboLmMW+SmVBHnb48eL9luzachEC7+i/70MOpq8odQPu5FsQ3J6GbticllAvxhycwTfs5Z1uiKgHf75pr8smVylhM6ZQI9C5gBKOUbAMasM91BjYx7kGTk5+e6aL/x1Kxblpodt83JViGACOx3dmg1Ii8plgLNuhWa85jG+jI+dVs18agP3mQc/v17JyEYk8eR93o54U00msYokUPSHiubc9f/N+sX5dZjuCLV9KVGEeDKVqQ95hCGvIJ/0wS4rAud1YYRggm8zifBn44oy6XacZvdzmj4uEdOagGgn6B5hJMWoTjKhxyVxe7O+2fjRPe+zeQASSFgIfDRVZn+TrXGxGum7bxzhVdaoIvAcXPPzGXMehF9vrfjg3am+2TglIyMFzRjwMh75/8Bed1sr1dXLxlYkYLqknr2Q3cPDs1gDvS6fxRFK2E0jYo3OzXHuBMH/PohVaWzaWU8uaSTfUBV1bIRH6/rbt1cJeDOxlyyuBRsKUEfdXAp8txj+mYwhOKnL0sSu2ylBqfEaDRHJwRy/wg0bAdwuNyjyrSOa4lFj2uiGlzV5++KY78KsB81YsunJOywrmzTbDWauSnNVCEvwnnYtVLmZgrBf7VrNyD6GSYDg="
    on:
      tags: true
    skip_existing: true
  - provider: script
    script: "bash conda-build/travis_deploy.sh"
    on:
      tags: true
